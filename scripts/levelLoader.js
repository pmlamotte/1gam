"use strict";

window.loadLevel = function (levelName, callback) {
	$.getJSON("maps/" + levelName + ".json", function (levelData) {
		loadTextures(levelData, callback);
	}).fail(function () {
		console.error("failed to retrieve data for level '" + levelName + "'");
	});
};

function loadTextures(level, cb) {
	var imageAssets = getAssetsFromLevel(level);

	textureFactory.load(imageAssets, function () {
		cb();
	});
}

function getAssetsFromLevel(level) {
	return _.map(level.tilesets, function (tileset) {
		return {
			path: tileset.image.replace("../", ""),
			id: tileset.name,
			tileDimensions: {
				x: Math.floor(tileset.imagewidth / tileset.tilewidth),
				y: Math.floor(tileset.imageheight / tileset.tileheight),
				width: tileset.tilewidth,
				height: tileset.tileheight,
				baseId: tileset.firstgid
			}
		};
	});
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxldmVsTG9hZGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTSxDQUFDLFNBQVMsR0FBRyxVQUFTLFNBQVMsRUFBRSxRQUFRLEVBQUU7QUFDaEQsRUFBQyxDQUFDLE9BQU8sV0FBUyxTQUFTLFlBQVMsVUFBUyxTQUFTLEVBQUU7QUFDdkQsY0FBWSxDQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQztFQUNsQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVc7QUFDbEIsU0FBTyxDQUFDLEtBQUsseUNBQXVDLFNBQVMsT0FBSSxDQUFDO0VBQ2xFLENBQUMsQ0FBQztDQUNILENBQUM7O0FBRUYsU0FBUyxZQUFZLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRTtBQUNoQyxLQUFJLFdBQVcsR0FBRyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQzs7QUFFNUMsZUFBYyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsWUFBVztBQUMzQyxJQUFFLEVBQUUsQ0FBQztFQUNMLENBQUMsQ0FBQztDQUNIOztBQUVELFNBQVMsa0JBQWtCLENBQUMsS0FBSyxFQUFFO0FBQ2xDLFFBQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLFVBQVMsT0FBTyxFQUFFO0FBQzlDLFNBQU87QUFDTixPQUFJLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQztBQUN0QyxLQUFFLEVBQUUsT0FBTyxDQUFDLElBQUk7QUFDaEIsaUJBQWMsRUFBRTtBQUNmLEtBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNyRCxLQUFDLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFDdkQsU0FBSyxFQUFFLE9BQU8sQ0FBQyxTQUFTO0FBQ3hCLFVBQU0sRUFBRSxPQUFPLENBQUMsVUFBVTtBQUMxQixVQUFNLEVBQUUsT0FBTyxDQUFDLFFBQVE7SUFDeEI7R0FDRCxDQUFDO0VBQ0YsQ0FBQyxDQUFDO0NBQ0giLCJmaWxlIjoibGV2ZWxMb2FkZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ3aW5kb3cubG9hZExldmVsID0gZnVuY3Rpb24obGV2ZWxOYW1lLCBjYWxsYmFjaykge1xuXHQkLmdldEpTT04oYG1hcHMvJHtsZXZlbE5hbWV9Lmpzb25gLCBmdW5jdGlvbihsZXZlbERhdGEpIHtcblx0XHRsb2FkVGV4dHVyZXMobGV2ZWxEYXRhLCBjYWxsYmFjayk7XG5cdH0pLmZhaWwoZnVuY3Rpb24oKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgZmFpbGVkIHRvIHJldHJpZXZlIGRhdGEgZm9yIGxldmVsICcke2xldmVsTmFtZX0nYCk7XG5cdH0pO1xufTtcblxuZnVuY3Rpb24gbG9hZFRleHR1cmVzKGxldmVsLCBjYikge1xuXHR2YXIgaW1hZ2VBc3NldHMgPSBnZXRBc3NldHNGcm9tTGV2ZWwobGV2ZWwpO1xuXG5cdHRleHR1cmVGYWN0b3J5LmxvYWQoaW1hZ2VBc3NldHMsIGZ1bmN0aW9uKCkge1xuXHRcdGNiKCk7XG5cdH0pO1xufVxuXG5mdW5jdGlvbiBnZXRBc3NldHNGcm9tTGV2ZWwobGV2ZWwpIHtcblx0cmV0dXJuIF8ubWFwKGxldmVsLnRpbGVzZXRzLCBmdW5jdGlvbih0aWxlc2V0KSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHBhdGg6IHRpbGVzZXQuaW1hZ2UucmVwbGFjZSgnLi4vJywgJycpLFxuXHRcdFx0aWQ6IHRpbGVzZXQubmFtZSxcblx0XHRcdHRpbGVEaW1lbnNpb25zOiB7XG5cdFx0XHRcdHg6IE1hdGguZmxvb3IodGlsZXNldC5pbWFnZXdpZHRoIC8gdGlsZXNldC50aWxld2lkdGgpLFxuXHRcdFx0XHR5OiBNYXRoLmZsb29yKHRpbGVzZXQuaW1hZ2VoZWlnaHQgLyB0aWxlc2V0LnRpbGVoZWlnaHQpLFxuXHRcdFx0XHR3aWR0aDogdGlsZXNldC50aWxld2lkdGgsXG5cdFx0XHRcdGhlaWdodDogdGlsZXNldC50aWxlaGVpZ2h0LFxuXHRcdFx0XHRiYXNlSWQ6IHRpbGVzZXQuZmlyc3RnaWRcblx0XHRcdH1cblx0XHR9O1xuXHR9KTtcbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=